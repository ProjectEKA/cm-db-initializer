<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext
   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd
   http://www.liquibase.org/xml/ns/dbchangelog
   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <changeSet id="202001071921" author="Chethan, Angshu" context="POC">
        <preConditions>
            <not>
                <tableExists tableName="discovery_request" />
            </not>
        </preConditions>
        <comment>Add DiscoveryRequest table</comment>

        <createTable tableName="discovery_request">
            <column name="id" autoIncrement="true" type="BIGINT">
                <constraints primaryKey="true" />
            </column>
            <column name="transaction_id" type="VARCHAR(50)">
                <constraints nullable="false" />
            </column>
            <column name="patient_id" type="VARCHAR(50)">
                <constraints nullable="false" />
            </column>
            <column name="hip_id" type="VARCHAR(50)">
                <constraints nullable="false" />
            </column>
            <column name="timestamp" type="DATETIME" defaultValueDate="CURRENT_TIMESTAMP">
                <constraints nullable="false" />
            </column>
        </createTable>
    </changeSet>

    <changeSet id="202001121105" author="Apoorva" context="POC">
        <preConditions>
            <not>
                <tableExists tableName="link_reference" />
            </not>
        </preConditions>
        <comment>Add link reference table</comment>

        <createTable tableName="link_reference">
            <column name="id" autoIncrement="true" type="BIGINT">
                <constraints primaryKey="true" />
            </column>
            <column name="patient_link_reference" type="JSON">
                <constraints nullable="false" />
            </column>
            <column name="hip_id" type="VARCHAR(50)">
                <constraints nullable="false" />
            </column>
            <column name="timestamp" type="DATETIME" defaultValueDate="CURRENT_TIMESTAMP">
                <constraints nullable="false" />
            </column>
        </createTable>
    </changeSet>

    <changeSet id="202001131305" author="Apoorva" context="POC">
        <preConditions>
            <not>
                <tableExists tableName="link" />
            </not>
        </preConditions>
        <comment>Add link reference table</comment>

        <createTable tableName="link">
            <column name="id" autoIncrement="true" type="BIGINT">
                <constraints primaryKey="true" />
            </column>
            <column name="hip_id" type="VARCHAR(50)">
                <constraints nullable="false" />
            </column>
            <column name="consent_manager_user_id" type="VARCHAR(50)">
                <constraints nullable="false" />
            </column>
            <column name="link_reference" type="VARCHAR(50)">
                <constraints nullable="false" />
            </column>
            <column name="patient" type="JSON">
                <constraints nullable="false" />
            </column>
            <column name="timestamp" type="DATETIME" defaultValueDate="CURRENT_TIMESTAMP">
                <constraints nullable="false" />
            </column>
        </createTable>
    </changeSet>


    <changeSet id="202001161930" author="angshu" context="POC">
        <preConditions>
            <not>
                <tableExists tableName="consent_request" />
            </not>
        </preConditions>
        <comment>Add consent_request table</comment>

        <createTable tableName="consent_request">
            <column name="id" autoIncrement="true" type="BIGINT">
                <constraints primaryKey="true" />
            </column>
            <column name="request_id" type="VARCHAR(50)">
                <constraints nullable="false" />
            </column>
            <column name="patient_id" type="VARCHAR(50)">
                <constraints nullable="false" />
            </column>
            <column name="status" type="VARCHAR(20)">
                <constraints nullable="false" />
            </column>
            <column name="details" type="JSON">
                <constraints nullable="false" />
            </column>
            <column name="timestamp" type="DATETIME" defaultValueDate="CURRENT_TIMESTAMP">
                <constraints nullable="false" />
            </column>
        </createTable>
    </changeSet>

    <changeSet id="202001222239" author="Chethan" context="POC">
        <preConditions>
            <not>
                <tableExists tableName="consent_artefact" />
            </not>
        </preConditions>
        <comment>Add consent_artefact table</comment>

        <createTable tableName="consent_artefact">
            <column name="id" autoIncrement="true" type="BIGINT">
                <constraints primaryKey="true" />
            </column>
            <column name="consent_artefact_id" type="VARCHAR(50)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="consent_request_id" type="VARCHAR(50)">
                <constraints nullable="false" />
            </column>
            <column name="patient_id" type="VARCHAR(50)">
                <constraints nullable="false" />
            </column>
            <column name="consent_artefact" type="JSON">
                <constraints nullable="false" />
            </column>
            <column name="signature" type="bytea">
                <constraints nullable="false" />
            </column>
            <column name="timestamp" type="DATETIME" defaultValueDate="CURRENT_TIMESTAMP">
                <constraints nullable="false" />
            </column>
        </createTable>
    </changeSet>

    <changeSet id="202002012300" author="angshu" context="POC">
        <renameColumn newColumnName="date_created"
                      oldColumnName="timestamp"
                      tableName="consent_artefact"/>
    </changeSet>
    <changeSet id="202002012305" author="angshu" context="POC">
        <createIndex indexName="idx_consent_artefact_id"
                     tableName="consent_artefact"
                     unique="true">
            <column name="consent_artefact_id"/>
        </createIndex>
    </changeSet>
    <changeSet id="202002012307" author="angshu" context="POC">
        <createIndex indexName="idx_ca_request_id"
                     tableName="consent_artefact">
            <column name="consent_request_id"/>
        </createIndex>
    </changeSet>
    <changeSet id="202002012308" author="angshu" context="POC">
        <createIndex indexName="idx_cr_request_id"
                     tableName="consent_request">
            <column name="request_id"/>
        </createIndex>
    </changeSet>
    <changeSet id="202002012311" author="angshu" context="POC">
        <modifyDataType columnName="signature"
                        newDataType="VARCHAR2"
                        tableName="consent_artefact"/>
    </changeSet>
    <changeSet id="202002012349" author="angshu" context="POC">
        <renameColumn newColumnName="date_created"
                      oldColumnName="timestamp"
                      tableName="consent_request"/>
    </changeSet>
    <changeSet id="202002012351" author="angshu" context="POC">
        <addColumn tableName="consent_artefact">
            <column name="status" type="VARCHAR(20)">
            </column>
        </addColumn>
    </changeSet>
    <changeSet id="202002101628" author="angshu" context="POC">
        <addColumn tableName="consent_request">
            <column name="date_modified" type="DATETIME" defaultValueDate="CURRENT_TIMESTAMP">
            </column>
        </addColumn>
    </changeSet>

</databaseChangeLog>